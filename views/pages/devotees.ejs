<%- include('../partials/header'); -%>
        <div id="page-wrapper">
            <div id="page-inner">


                <div class="row">
                    <div class="col-md-12">
                        <h1 class="page-header">
                           Devotees <small> - <span id ="todayDate"></span> [ <span id ="todayTime"></span> ]</small>
                        </h1>
                    </div>
                </div>


                <!-- Image loader -->
                <div id='loader' style='display: none;'>
                    <img src='/img/loader/loader-1.gif' width='250px' height='250px' style="margin-top: 220px; margin-left: 680px;">
                </div>
                <!-- Image loader -->

                <div class="row">
                    <div class="col-md-12 col-sm-12">
                        <div class="panel panel-primary" id="devotee_add_panel">
                            <div class="panel-heading">
                                Add a Devotee
                                <!-- <button type="button" class="btn btn-secondary btn-sm" data-toggle="collapse" data-target="#panel-one-body"><span class="glyphicon glyphicon-plus"></span></button> -->
                                <a class="accordion-toggle" data-toggle="collapse"  href="#panel-one-body"></a>
                            </div>
                            
                            <div class="panel-body collapse" id="panel-one-body">  
                                <!-- <button type="button" class="btn btn-secondary btn-sm"><span class="glyphicon glyphicon-plus"> New Donation</span></button>  -->
                                
                                
                                <form class="form-horizontal" action="#" id="newDevoteeForm">
                                    <div class="form-group">
                                        <label class="control-label col-sm-4" for="title">Title:</label>
                                        <div class="col-sm-8">
                                            <select name="title" id="title" class="form-control" >
                                                <option value=" ">---&nbsp;---</option>
                                                <option value="Prabrajika">Prabrajika</option>
                                                <option value="Bramhacharini">Bramhacharini</option>
                                                <option value="Shrimat Swami">Shrimat Swami</option>
                                                <option value="Swami">Swami</option>
                                                <option value="Bramhachari">Bramhachari</option>
                                                <option value="Shri">Shri</option>
                                                <option value="Smt.">Smt.</option>
                                                <option value="Mr.">Mr.</option>
                                                <option value="Mrs.">Mrs.</option>
                                                <option value="Miss">Miss</option>
                                                <option value="Ms">Ms</option>
                                                <option value="Prof(Dr.)">Prof(Dr.)</option>
                                                <option value="Dr.">Dr.</option>
                                                <option value="Prof.">Prof.</option>
                                                <option value="Lt. Col.">Lt. Col.</option>
                                                <option value="Justice">Justice</option>
                                                <option value="M/S">M/S</option>
                                            </select>
                                        </div>
                                    </div> 
                                    <div class="form-group">
                                        <label class="control-label col-sm-4" for="fName">First Name:</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="fName" placeholder="Enter First name" name="fName">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-sm-4" for="lName">Last Name:</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="lName" placeholder="Enter Last name" name="lName">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                      <label class="control-label col-sm-4" for="email">Email:</label>
                                      <div class="col-sm-8">
                                        <input type="email" class="form-control" id="email" placeholder="Enter email" name="email">
                                      </div>
                                    </div>
                                    <!-- <div class="form-group">
                                        <label class="control-label col-sm-4" for="sfno">Street/Flat No :</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="sfno" placeholder="Enter Street/Flat No" name="sfno">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-sm-4" for="street">Steet :</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="street" placeholder="Enter Stree Name" name="street">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-sm-4" for="city">City :</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="city" placeholder="Enter City Name" name="city">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-sm-4" for="district">District :</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="district" placeholder="Enter District Name" name="district">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-sm-4" for="country">Country:</label>
                                        <div class="col-sm-8">
                                            <textarea name="country" id="country" style="resize: none;" class="form-control" placeholder="Enter Country Name"></textarea>
                                        </div>
                                    </div> -->
                                    <div class="form-group">
                                        <label class="control-label col-sm-4" for="address">Address:</label>
                                        <div class="col-sm-8">
                                            <textarea name="address" id="address" style="resize: none;" class="form-control" placeholder="Enter Address"></textarea>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-sm-4" for="pincode">PIN :</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="pincode" placeholder="Enter PIN Code" name="pincode">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-sm-4" for="phone">Contact:</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="phone" placeholder="Enter Contact No" name="phone">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-sm-4" for="pan_no">PAN:</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="pan_no" placeholder="Enter PAN No" name="pan_no">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-sm-4" for="remarks">Remarks :</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="remarks" placeholder="Enter Any Details Except PAN e.x. AD(213 123 123 123), DRIV)L(ASDS...XX), RATION(xxxx..xx)" name="remarks" style="height: 5em;">
                                        </div>
                                    </div>
                                    <div class="form-group" style="margin-left: 23%;">
                                        <button type="button" class="btn btn-primary" id="regitserNewDevotee">Register Devotee</button>
                                        <button class=" btn btn-secondaryaccordion-toggle collapsed" data-toggle="collapse" type="button" class="" data-target="#panel-one-body">Close</button>
                                        <!-- <a class="accordion-toggle collapsed" data-toggle="collapse" href="#panel-one-body" aria-expanded="false"></a> -->
                                    </div>
                                </form>
                            </div>
                        </div> <!-- panel ending-->
                    </div>
                </div>


                <div class="row">
                    <div class="col-md-12 col-sm-12">
                        <div class="panel panel-primary" id="devotee_panel">
                            <div class="panel-heading">
                                Devotees
                            </div>
                            <div class="panel-body">  
                                <!-- <button type="button" class="btn btn-secondary btn-sm"><span class="glyphicon glyphicon-plus"> New Donation</span></button>  -->
                                <!-- <div class=" table table-striped table-bordered table-hover"> -->
                                    <table class="table display table-responsive table-striped table-bordered table-hover" id="dataTables_devotees">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Name</th>
                                                <th>Email</th>
                                                <th>Address</th>
                                                <th>Contact</th>
                                                <th>PAN NO</th>
                                                <th>Remarks</th>
                                                <th>Edit</th>
                                            </tr>
                                        </thead>
                                        <tbody id="devotees_tbody">
                                            
                                        </tbody>
                                    </table>
                                <!-- </div> -->
                           </div>
                            
                        </div>
                    </div>
                    
                </div>

                
               
                <!-- /. ROW  -->
				
            </div>
            <!-- /. PAGE INNER  -->
        </div>
        <!-- /. PAGE WRAPPER  -->
    </div>
    <!-- /. WRAPPER  -->
<div id="newBookingModal" class="modal fade" role="dialog">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
            <div class="modal-body" id="confirmBookingModal">
                <span><strong>Guest Details</strong></span>
                <button type="button" class="close" data-dismiss="modal">×</button> <br><br>
                

                
            </div>
            </div>
        </div>
        </div>


        <div id="editDevoteeModal" class="modal fade" role="dialog">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
            <div class="modal-body" id="editDevoteeModalBody">
                <span><strong>Update Guest Details</strong></span>
                <button type="button" class="close" data-dismiss="modal">×</button> <br><br>
                <form class="form-horizontal" action="#" id="devoteeEditForm">
                    <div class="form-group">
                        <label class="control-label col-sm-4" for="title">Title:</label>
                        <div class="col-sm-8">
                            <select name="title" id="utitle" class="form-control" >
                                <option value=" ">---&nbsp;---</option>
                                <option value="Prabrajika">Prabrajika</option>
                                <option value="Bramhacharini">Bramhacharini</option>
                                <option value="Shrimat Swami">Shrimat Swami</option>
                                <option value="Swami">Swami</option>
                                <option value="Bramhachari">Bramhachari</option>
                                <option value="Shri">Shri</option>
                                <option value="Smt">Smt</option>
                                <option value="Mr.">Mr.</option>
                                <option value="Mrs.">Mrs.</option>
                                <option value="Miss">Miss</option>
                                <option value="Ms">Ms</option>
                                <option value="Prof(Dr.)">Prof(Dr.)</option>
                                <option value="Dr.">Dr.</option>
                                <option value="Prof.">Prof.</option>
                                <option value="Lt. Col.">Lt. Col.</option>
                                <option value="Justice">Justice</option>
                                <option value="<M/S>">M/S</option>
                            </select>
                        </div>
                    </div> 
                    <div class="form-group">
                        <label class="control-label col-sm-4" for="ufName">First Name:</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="ufName" placeholder="Enter First name" name="fName">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-4" for="ulName">Last Name:</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="ulName" placeholder="Enter Last  name" name="lName">
                        </div>
                    </div>
                    <div class="form-group">
                      <label class="control-label col-sm-4" for="uemail">Email:</label>
                      <div class="col-sm-8">
                        <input type="email" class="form-control" id="uemail" placeholder="Enter email" name="email">
                      </div>
                    </div>
                    <!-- <div class="form-group">
                        <label class="control-label col-sm-4" for="usfno">Street/Flat No :</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="usfno" placeholder="Enter Street/Flat No" name="sfno">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-4" for="ustreet">Steet :</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="ustreet" placeholder="Enter Stree Name" name="street">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-4" for="ucity">City :</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="ucity" placeholder="Enter City Name" name="city">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-4" for="udistrict">District :</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="udistrict" placeholder="Enter District Name" name="district">
                        </div>
                    </div> -->
                    <div class="form-group">
                        <label class="control-label col-sm-4" for="ucountry">Address:</label>
                        <div class="col-sm-8">
                            <textarea name="address" id="uaddress" style="resize: none;" class="form-control"></textarea>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-4" for="upincode">PIN :</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="upincode" placeholder="Enter District Name" name="pincode">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-4" for="uphone">Contact:</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="uphone" placeholder="Enter Contact No" name="phone">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-4" for="upan_no">PAN:</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="upan_no" placeholder="Enter PAN No" name="pan_no">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-4" for="uremarks">Remarks :</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="uremarks" placeholder="Enter Any Details Except PAN e.x. AD(213 123 123 123), DRIV)L(ASDS...XX), RATION(xxxx..xx)" name="remarks" style="height: 5em;">
                        </div>
                    </div>
                    <input type="hidden" name="devotee_id_hidden" id="devotee_id_hidden">
                    <div class="form-group" style="margin-left: 35%">
                        <button type="button" class="btn btn-primary" id="updateDevotee">Save Changes</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </form>
            </div>
            </div>
        </div>
        </div>
    
    
    <%- include('../partials/footer');%>
<script>
    $(document).ready(function() {
        //dataTables_devotees
        $.ajax({
        type : 'POST',
        url:'/devotees',
        headers: {"x-access-token": localStorage.getItem('token')},
        beforeSend: function(){
            // Show image container
            // $("#dataTables_devotees tr").remove();
            $("#devotee_panel").hide();
            $("#devotee_add_panel").hide();
            $("#loader").show();
        },
        success : function(response){
            if(response.success == 1 && response.failure == 0){
                var tbody;
                var myDate1, myDate2;
                // if(response.data==true) $('#dataTables_devotees').html('');
                $.each(response.devotees, function (key, value){
                    tbody += "<tr>";
                    tbody += "<td>"+response.devotees[key].devotee_id+"</td>";
                    tbody += "<td>"+response.devotees[key].title+ " " + response.devotees[key].fName+ " " +  " " + response.devotees[key].lName+ " " + "</td>";
                    tbody += "<td>"+response.devotees[key].email+"</td>";
                    // tbody += "<td>"+response.devotees[key].address + ' - ' +response.devotees[key].pincode + '  ' +response.devotees[key].country + "</td>";
                    tbody += "<td>"+response.devotees[key].address + ' - ' +response.devotees[key].pincode +"</td>";
                    tbody += "<td>"+response.devotees[key].phone+"</td>";
                    tbody += "<td>"+response.devotees[key].pan_no +"</td>";
                    tbody += "<td>"+response.devotees[key].remarks +"</td>";
                    tbody += "<td>";
                    tbody += "<button type='button' class='btn btn-success btn-sm editDevotee' data-uid='"+response.devotees[key].devotee_id+"' ><span class='glyphicon glyphicon-pencil'></span></button> &nbsp;";
                    // tbody += "<button type='button' class='btn btn-danger btn-sm deleteDetails' data-uid='"+response.devotees[key].devotee_id+"' ><span class='glyphicon glyphicon-trash'></span></button>";
                    tbody += "&emsp;&emsp;&emsp;&emsp;</td>";
                    tbody += "</tr>";
                });
                $('#dataTables_devotees').append(tbody);
                $('#dataTables_devotees').dataTable({
                    pageLength: 100,
                    "columnDefs": [
                        { "width": "2px", "targets": 0 },
                        { "width": "40px", "targets": 1 },
                        { "width": "100px", "targets": 2 },
                        { "width": "70px", "targets": 3 },
                        { "width": "70px", "targets": 4 },
                        { "width": "70px", "targets": 5 },
                        { "width": "70px", "targets": 5 }
                    ]
                });
                
            }
        },
        complete:function(data){
            // Hide image container
            $("#loader").hide();
            $("#devotee_panel").show();
            $("#devotee_add_panel").show();
        },
        error: function(err){
            console.log(err);
        }
    });
    $(document).on('click', '.editDevotee', function(e){
        var devotee_id = $(this).data('uid');
        $('#devotee_id_hidden').val(devotee_id);
        console.log(devotee_id);
        $.ajax({
            url : '/devotees/showDevoteeDetails',
            type : 'POST',
            headers : { "x-access-token" : localStorage.getItem('token') },
            data : { devotee_id_search : devotee_id },
            success : function(response){
                if(response.success == 1 & response.failure == 0){
                    // var sampleStr = response.devotee_details[0].address;
                    // var fields = sampleStr.split(',');
                    // var sfno = fields[0];
                    // var street = fields[1]; 
                    // var city = fields[2];
                    // var district = fields[3];
                    $('#utitle').val(response.devotee_details[0].title);
                    $('#ufName').val(response.devotee_details[0].fName);
                    $('#ulName').val(response.devotee_details[0].lName);
                    $('#uemail').val(response.devotee_details[0].email);
                    // $('#usfno').val(sfno);
                    // $('#ustreet').val(street);
                    // $('#ucity').val(city);
                    // $('#udistrict').val(district);
                    // $('#uaddress').val(response.devotee_details[0].address);
                    $('#uaddress').html(response.devotee_details[0].address);
                    $('#upincode').val(response.devotee_details[0].pincode);
                    $('#uremarks').val(response.devotee_details[0].remarks);
                    $('#uphone').val(response.devotee_details[0].phone);
                    $('#upan_no').val(response.devotee_details[0].pan_no);
                    $('#devotee_id_hidden').val(devotee_id);
                    $('#editDevoteeModal').modal('show');
                }
            },
            error : function(){

            }
        });
     });
     $(document).on('click', '#updateDevotee', function(e){
        $.ajax({
            url : '/devotees/updateDevoteeDetails',
            type : 'POST',
            headers : { "x-access-token" : localStorage.getItem('token') },
            data : $('#devoteeEditForm').serialize(),
            success : function(response){
                if(response.success == 1 & response.failure == 0){
                    toastr.info(response.msg);
                    $('#editDevoteeModal').modal('hide');
                }
                if(response.success == 0 && response.failure == 1){
                    if(response.errorData == true){
                        $.each(response.errors, function(i, item) {
                        toastr.error(response.errors[i].msg);// alert(data[i].PageName);
                        });
                    }else{
                        toastr.error(response.msg);
                    }
                }
            },
            error : function(){

            }
        });
     });
    //  $(document).on('click', '#regitserNewDevoteeO', function(e){
    //     $.ajax({
    //         url : '/devotees/updateDevoteeDetails',
    //         type : 'POST',
    //         headers : { "x-access-token" : localStorage.getItem('token') },
    //         data : $('#devoteeEditForm').serialize(),
    //         success : function(response){
    //             if(response.success == 1 & response.failure == 0){
    //                 toastr.info(response.msg);
    //                 $('#editDevoteeModal').modal('hide');
    //             }
    //         },
    //         error : function(){

    //         }
    //     });
    //  });
} );
</script>
    