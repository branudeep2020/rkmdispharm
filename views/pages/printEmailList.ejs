<html>
<head>
		<meta charset="utf-8">
		<title>RKMAM - Recipt</title>
		<!-- <link rel="stylesheet" href="css/style.css">
		<link rel="license" href="https://www.opensource.org/licenses/mit-license/">
		<script src="js/script.js"></script> -->
		<link href="/css/bootstrap.min.css" rel="stylesheet" />
		<link href="/css/font-awesome.css" rel="stylesheet" />
		<link href="/js/morris/morris-0.4.3.min.css" rel="stylesheet" />
		<link href="/css/toastr.min.css" rel="stylesheet" />
		<link href="/css/jquery-ui.css" rel="stylesheet" />
		<link href="/css/open-sans-font.css" rel="stylesheet" />
		<link href="/css/custom-styles.css" rel="stylesheet" />
</head>

<body>
    <h3 id="EmailCount" style="text-align: center;"></h3>
<div class="col-md-12 col-sm-12" style="width: 100%; padding : 5px 5px;">
    <table class="table display table-responsive table-striped table-bordered table-hover" id="reportTable" style="font-size: 12px;">
   <tbody id="report_tbody">
        <tr>
            <th scope="col">SlNo</th>
            <th scope="col">Emails</th>
            <th scope="col">Name</th>
            <th scope="col">Address</th>
            <th scope="col">Contact</th>
            <th scope="col">PAN</th>
            <th scope="col">Remarks</th>
        </tr>
        <!-- <tr><td>E00015</td><td>02-01-2021</td><td>Rs : 3112/-</td><td>CASH</td><td>INR</td><td>CASH : 3112</td><td>THAKUR UTSAV</td><td>2</td></tr> -->
        
        </tbody>
    </table>
    <p>&nbsp;</p>
    <!-- <a id="down_report" download="down_report" href="/files/download.xlsx" target="_blank" class="btn btn-primary" style="margin: 3em 7em;">DOWNLOAD EXCEL</a> -->
    <button id="down_report" type="button" class="btn btn-primary" style="margin: 0 10em;">DOWNLOAD EXCEL</button>
</div> 
</body>
</html>

<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/moment.min.js"></script>
<script src="/js/toastr.min.js"></script>
<script src="/js/jquery-ui.min.js"></script>
<script src="/js/jquery.metisMenu.js"></script>
<script src="/js/morris/raphael-2.1.0.min.js"></script>
<script src="/js/morris/morris.js"></script>
<script src='/js/excelexportjs.js'></script>
<script src='/js/ckeditor/ckeditor.js'></script>
<script src="/js/xlsx.full.min.js"></script>
<script src="/js/FileSaver.min.js"></script>
<script>
    // function GetURLParameter(sParam){
    //     var sPageURL = window.location.search.substring(1);
    //     var sURLVariables = sPageURL.split('&');
    //     for (var i = 0; i < sURLVariables.length; i++){
    //         var sParameterName = sURLVariables[i].split('=');
    //         if (sParameterName[0] == sParam) return sParameterName[1];
    //     }
    // }
    $(document).ready( function() {
        $.ajax({
              type : 'POST',
              url : '/genReport/getallEmails',
              headers: {"x-access-token": localStorage.getItem('token')},
            //   data : { reportDateFrom : reportDateFrom, reportDateTo : reportDateTo},
              success : function(response){
                if(response.success == 1 && response.failure == 0){ 
                  var tbody;
                  var myDate1;
                  $.each(response.emails, function(key, value) { 
                        tbody += '<tr><td>'+parseInt(key+1)+'</td>';
                        tbody += '<td>'+response.emails[key].email+'</td>';
                        tbody += '<td>'+response.emails[key].title+' '+response.emails[key].fName+' '+response.emails[key].lName+'</td>';
                        tbody += '<td>'+response.emails[key].address+' PIN : '+response.emails[key].pincode+'</td>';
                        tbody += '<td>'+response.emails[key].phone+'</td>';
                        tbody += '<td>'+response.emails[key].pan_no+'</td>';
                        tbody += '<td>'+response.emails[key].remarks+'</td></tr>';
                    });
                  $('#reportTable').append(tbody);
                  $('#EmailCount').html('Total Emails : '+response.count+'<br/>');
                  toastr.info(response.msg);
                }
                if(response.success == 0 && response.failure == 1){
                  if(response.errorData == true){
                      $.each(response.errors, function(i, item) {
                      toastr.error(response.errors[i].msg);// alert(data[i].PageName);
                      });
                  }else{
                      toastr.error(response.msg);
                  }
                }
              }
            }); 
        //NORMAL XLS DOWNLOAD
        $(document).on('click','#down_report', function(e) {
            e.preventDefault();  //stop the browser from following
            $("#repotTable").excelexportjs({
                containerid: "reportTable",
                datatype: 'table'
            });
        });
});  
        // var wb = XLSX.utils.table_to_book(document.getElementById('reportTable'), {sheet:"sheet1"});
        // var wbout = XLSX.write(wb, {bookType:'xlsx', bookSST:true, type: 'binary'});
        // function s2ab(s) {
        //                 var buf = new ArrayBuffer(s.length);
        //                 var view = new Uint8Array(buf);
        //                 for (var i=0; i<s.length; i++) view[i] = s.charCodeAt(i) & 0xFF;
        //                 return buf;
        // }

        // $(document).on('click','#down_report', function(e) {
        //     saveAs(new Blob([s2ab(wbout)],{type:"application/octet-stream"}), 'donations.xlsx');
        // });
        // var xlsHeader = ["RNo", "Date", "Amount","Currency","Payment Details","Purpose", "DevoteeID"];
</script>